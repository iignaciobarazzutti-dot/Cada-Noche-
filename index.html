<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Ti, Mi Amor</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Patrick+Hand&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-sky-top: #050611;
            --dark-sky-bottom: #161938;
            --grass-back: #0a1f11;
            --grass-front: #14361e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, var(--dark-sky-top), var(--dark-sky-bottom));
            font-family: 'Patrick Hand', cursive;
        }

        /* --- Canvas para estrellas (fijas y fugaces) --- */
        #skyCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* --- Nubes Suaves --- */
        .cloud-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 60%;
            z-index: 2;
            pointer-events: none;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.03); /* Muy transparente */
            border-radius: 50%;
            filter: blur(25px); /* Efecto difuso */
            animation: floatCloud linear infinite;
        }

        /* --- La Luna --- */
        .moon {
            position: absolute;
            top: 50px; right: 40px;
            width: 70px; height: 70px;
            background: #fdfd96;
            border-radius: 50%;
            box-shadow: 0 0 40px #fdfd96, 0 0 90px rgba(253, 253, 150, 0.3);
            z-index: 3;
            animation: moonFloat 12s infinite ease-in-out alternate;
        }

        /* --- Campo y Flores --- */
        .field {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40vh; /* Campo más alto */
            background: linear-gradient(to bottom, var(--grass-back), var(--grass-front));
            border-radius: 60% 60% 0 0 / 25px 25px 0 0;
            z-index: 4;
            overflow: hidden;
        }

        .flower {
            position: absolute;
            transform-origin: bottom center;
            animation: sway 4s infinite ease-in-out;
            pointer-events: none;
        }

        /* Estilos SVG de flores */
        .flower svg {
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.6));
        }

        /* --- UI Principal --- */
        .ui-container {
            position: absolute;
            top: 45%; /* Un poco más arriba para dejar ver el campo */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 550px;
            z-index: 20;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Reloj */
        .clock-container {
            /* Fondo aún más sutil */
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(3px);
            margin-bottom: 25px;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.1);
        }

        #clock {
            font-family: 'Share Tech Mono', monospace;
            font-size: 3rem;
            color: #e0f7fa;
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.6);
            letter-spacing: 2px;
        }

        .date-display {
            font-family: 'Share Tech Mono', monospace;
            color: #81d4fa;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Mensaje de Buenas Noches */
        .message-box {
            /* Hecho más transparente (aprox 5% opacidad blanca) */
            background: rgba(255, 255, 255, 0.04);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            /* El blur ayuda a leer aunque sea transparente */
            backdrop-filter: blur(6px); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .message-box::before {
            content: '"';
            position: absolute;
            top: -15px; left: 15px;
            font-family: 'Fredoka One', cursive;
            font-size: 3.5rem;
            color: rgba(255, 255, 255, 0.1);
        }

        #nightMessage {
            font-size: 1.4rem;
            line-height: 1.5;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 1.2s ease, transform 1.2s ease;
        }

        #nightMessage.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .heart-icon {
            color: #ff6b6b;
            animation: beat 2s infinite;
            display: inline-block;
            margin-top: 15px;
            filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));
        }

        /* --- Animaciones --- */
        @keyframes sway {
            0%, 100% { transform: rotate(-4deg); }
            50% { transform: rotate(4deg); }
        }
        @keyframes moonFloat {
            0% { transform: translateY(0); }
            100% { transform: translateY(-15px); }
        }
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            10% { transform: scale(1.3); }
            20% { transform: scale(1); }
            30% { transform: scale(1.3); }
            40% { transform: scale(1); }
        }
        @keyframes floatCloud {
            from { transform: translateX(-100%); }
            to { transform: translateX(100vw); }
        }

        @media (max-width: 600px) {
            #clock { font-size: 2.2rem; }
            .message-box { padding: 1.5rem; }
            .field { height: 45vh; }
        }
    </style>
</head>
<body>

    <canvas id="skyCanvas"></canvas>
    
    <div class="cloud-container" id="cloudContainer"></div>
    
    <div class="moon"></div>

    <div class="ui-container">
        <div class="clock-container">
            <div id="clock">00:00:00</div>
            <div class="date-display" id="dateText">--/--/----</div>
        </div>

        <div class="message-box">
            <div id="nightMessage">Leyendo las estrellas...</div>
        </div>
    </div>

    <div class="field" id="flowerField"></div>

    <script>
        // ==========================================
        // 1. CIELO: ESTRELLAS ESTÁTICAS Y FUGACES
        // ==========================================
        const canvas = document.getElementById('skyCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let stars = [];
        let shootingStars = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            initStars();
        }

        function initStars() {
            stars = [];
            // Crear estrellas de fondo
            for (let i = 0; i < 250; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * (height * 0.8),
                    size: Math.random() * 1.5,
                    opacity: Math.random(),
                    twinkleSpeed: Math.random() * 0.05 + 0.01
                });
            }
        }

        function createShootingStar() {
            // Nace en una posición aleatoria (generalmente arriba o izquierda)
            const startX = Math.random() * width;
            const startY = Math.random() * (height * 0.3); // Solo parte superior
            shootingStars.push({
                x: startX,
                y: startY,
                len: Math.random() * 80 + 50, // Longitud de la cola
                speed: Math.random() * 10 + 10,
                size: Math.random() * 2 + 0.1,
                vx: 1, // Dirección X (siempre derecha)
                vy: 0.5 // Dirección Y (siempre abajo)
            });
        }

        function draw() {
            // Fondo limpio (usando clearRect para transparencia sobre el gradiente CSS)
            ctx.clearRect(0, 0, width, height);
            
            // 1. Dibujar Estrellas Normales
            ctx.fillStyle = "white";
            stars.forEach(star => {
                // Efecto de parpadeo suave
                const twinkle = Math.abs(Math.sin(Date.now() * 0.001 + star.x));
                ctx.globalAlpha = star.opacity * twinkle + 0.3; // Mínimo 0.3 de opacidad
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // 2. Lógica de Estrella Fugaz
            // Probabilidad baja de aparecer en cada frame (ej. 0.5%)
            if (Math.random() < 0.005) {
                createShootingStar();
            }

            // Dibujar Estrellas Fugaces
            for (let i = 0; i < shootingStars.length; i++) {
                let s = shootingStars[i];
                
                // Mover
                s.x += s.speed * 1.5; // Más rápido en X
                s.y += s.speed * 0.7; // Lento en Y

                // Dibujar cola (gradiente)
                let tailX = s.x - s.len;
                let tailY = s.y - (s.len * 0.5); // Ajuste de ángulo visual
                
                let gradient = ctx.createLinearGradient(s.x, s.y, tailX, tailY);
                gradient.addColorStop(0, "rgba(255, 255, 255, 1)");
                gradient.addColorStop(1, "rgba(255, 255, 255, 0)");

                ctx.strokeStyle = gradient;
                ctx.lineWidth = s.size;
                ctx.lineCap = "round";
                ctx.beginPath();
                ctx.moveTo(s.x, s.y);
                ctx.lineTo(tailX, tailY);
                ctx.stroke();

                // Eliminar si sale de pantalla
                if (s.x > width + 100 || s.y > height + 100) {
                    shootingStars.splice(i, 1);
                    i--;
                }
            }

            requestAnimationFrame(draw);
        }

        window.addEventListener('resize', resize);
        resize();
        draw();

        // ==========================================
        // 2. NUBES SUAVES (DOM)
        // ==========================================
        const cloudContainer = document.getElementById('cloudContainer');
        function initClouds() {
            for(let i=0; i<6; i++) {
                const cloud = document.createElement('div');
                cloud.classList.add('cloud');
                // Tamaños y posiciones aleatorias
                const w = 150 + Math.random() * 300;
                const h = 50 + Math.random() * 100;
                cloud.style.width = w + 'px';
                cloud.style.height = h + 'px';
                cloud.style.top = (Math.random() * 40) + '%'; // Solo en la mitad superior
                
                // Duración aleatoria de animación (muy lento)
                const duration = 40 + Math.random() * 60;
                cloud.style.animationDuration = duration + 's';
                
                // Retraso negativo para que ya estén en pantalla al iniciar
                cloud.style.animationDelay = -(Math.random() * 100) + 's';
                
                cloudContainer.appendChild(cloud);
            }
        }
        initClouds();

        // ==========================================
        // 3. GENERADOR DE FLORES (PROFUNDIDAD 3D)
        // ==========================================
        const field = document.getElementById('flowerField');
        const flowerColors = ['#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA', '#ffffff'];

        function createFlowers() {
            field.innerHTML = '';
            // Cantidad de flores basada en el ancho, pero muchas más para llenar el campo
            const density = window.innerWidth < 600 ? 60 : 120; 
            
            // Creamos un array para ordenarlas por "z-index" (las de arriba primero)
            let flowerArray = [];

            for (let i = 0; i < density; i++) {
                // Posición Vertical (Y): 0% es abajo (frente), 100% es arriba (horizonte)
                // Usamos pow para que haya más flores en el horizonte (lejos) y menos cerca
                const depth = Math.random(); // 0 a 1
                const bottomPos = depth * 90; // 0% a 90% del alto del contenedor
                
                // Escala: Cuanto más arriba (mayor bottomPos), más pequeña
                // Cerca (bottom 0) = escala 1.2
                // Lejos (bottom 90) = escala 0.3
                const scale = 1.2 - (depth * 0.9);
                
                // Z-Index: Cuanto más "abajo" visualmente, mayor z-index para tapar a las de atrás
                const zIndex = Math.floor((1 - depth) * 1000);

                // Brillo/Opacidad: Las de lejos un poco más oscuras/transparentes para atmósfera
                const opacity = 1 - (depth * 0.3);
                const filter = `brightness(${100 - (depth * 30)}%)`;

                flowerArray.push({
                    left: Math.random() * 100,
                    bottom: bottomPos,
                    scale: scale,
                    zIndex: zIndex,
                    color: flowerColors[Math.floor(Math.random() * flowerColors.length)],
                    animDelay: Math.random() * 4,
                    opacity: opacity,
                    filter: filter
                });
            }

            // Renderizar
            flowerArray.forEach(data => {
                const el = document.createElement('div');
                el.classList.add('flower');
                el.style.left = data.left + '%';
                el.style.bottom = data.bottom + '%';
                el.style.zIndex = data.zIndex;
                el.style.animationDelay = data.animDelay + 's';
                el.style.opacity = data.opacity;
                el.style.filter = data.filter;

                // SVG optimizado
                const size = 50 * data.scale; // Tamaño base pixel
                el.innerHTML = `
                    <svg width="${size}" height="${size * 1.5}" viewBox="0 0 50 75" style="overflow:visible">
                        <!-- Tallo -->
                        <path d="M25 75 Q 25 50 25 35" stroke="#0a2a16" stroke-width="2" fill="none"/>
                        <!-- Pétalos -->
                        <circle cx="20" cy="30" r="8" fill="${data.color}" />
                        <circle cx="30" cy="30" r="8" fill="${data.color}" />
                        <circle cx="25" cy="22" r="8" fill="${data.color}" />
                        <circle cx="25" cy="38" r="8" fill="${data.color}" />
                        <!-- Centro -->
                        <circle cx="25" cy="30" r="5" fill="#FFF9C4" />
                    </svg>
                `;
                field.appendChild(el);
            });
        }
        createFlowers();
        window.addEventListener('resize', () => { setTimeout(createFlowers, 500) });


        // ==========================================
        // 4. LÓGICA DE MENSAJES (SISTEMA DE NOCHE)
        // ==========================================
        const messages = [
            "Que la luna te cuide mientras mis pensamientos te abrazan. Buenas noches.",
            "Eres el sueño más bonito del que no quiero despertar.",
            "Descansa mi amor, mañana el mundo te necesita brillando.",
            "Cierra los ojos y siente cómo mi amor viaja hasta ti.",
            "Ni todas las estrellas juntas brillan tanto como tú. Descansa.",
            "Espero que sueñes cosas tan hermosas como lo que me haces sentir.",
            "Buenas noches a la dueña absoluta de mi corazón.",
            "La noche es oscura, pero tu recuerdo me ilumina. Te amo.",
            "Que descanses, mi vida. Mañana será otro día para amarnos más.",
            "Duerme sabiendo que eres lo más importante en mi vida.",
            "Te envío un beso de buenas noches que dura hasta el amanecer.",
            "Que los ángeles te arrullen y te den la paz que mereces.",
            "Eres mi último pensamiento hoy y serás el primero mañana.",
            "Ojalá pudiera colarme en tus sueños para no separarme de ti.",
            "La distancia separa cuerpos, pero no corazones. Buenas noches.",
            "Que tengas dulces sueños, mi amor eterno.",
            "El cielo está celoso de ver que tengo una estrella más bonita aquí en la tierra.",
            "Descansa bien, recarga tu magia.",
            "Buenas noches, mi amor. Gracias por existir.",
            "Que la calma de la noche te llene de paz.",
            "Hasta mañana, mi pedacito de cielo.",
            "Sueña bonito, sueña conmigo.",
            "Que tu almohada sea suave y tus problemas desaparezcan.",
            "Te quiero hasta el infinito y más allá. Descansa.",
            "Eres mi refugio favorito. Buenas noches.",
            "Que duermas como un bebé, mi vida.",
            "Buenas noches, princesa de mi cuento favorito.",
            "El día terminó, pero mi amor por ti nunca acaba.",
            "Te abrazo con el alma desde aquí. Descansa.",
            "Que tengas una noche tan linda como tu sonrisa.",
            "Hasta mañana, mi amor. Te llevo en mi mente.",
            "Que descanses profundamente y despiertes feliz.",
            "Eres el motivo de mis sonrisas antes de dormir.",
            "Buenas noches, mi amor. Mañana te querré más.",
            "Que la noche te regale los sueños que deseas.",
            "Eres mi paz en medio del caos. Descansa.",
            "Buenas noches, mi tesoro más valioso.",
            "Que el silencio de la noche te traiga serenidad.",
            "Hasta mañana, luz de mis ojos.",
            "Que tengas un sueño reparador y lleno de amor.",
            "Buenas noches, mi vida entera.",
            "Eres la mejor parte de mis días y mis noches.",
            "Que descanses, mi amor. Te adoro.",
            "Hasta mañana, mi compañera de vida.",
            "Que sueñes con los angelitos, mi amor.",
            "Buenas noches, mi estrella polar.",
            "Te mando un abrazo gigante de buenas noches.",
            "Que descanses, mi amor. Eres única.",
            "Buenas noches, mi amor. Siempre juntos.",
            "Que la noche te envuelva con su magia."
        ];

        const clockElement = document.getElementById('clock');
        const dateTextElement = document.getElementById('dateText');
        const msgElement = document.getElementById('nightMessage');
        let currentMessageIndex = -1;

        // Algoritmo de Hashing Diario
        function getMessageForDate(dateSeed) {
            const year = dateSeed.getFullYear();
            const month = dateSeed.getMonth() + 1;
            const day = dateSeed.getDate();
            const dateString = `${year}${month}${day}`;
            
            let hash = 0;
            for (let i = 0; i < dateString.length; i++) {
                hash = ((hash << 5) - hash) + dateString.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash) % messages.length;
        }

        function updateSystem() {
            const now = new Date();
            
            // Reloj
            const h = String(now.getHours()).padStart(
